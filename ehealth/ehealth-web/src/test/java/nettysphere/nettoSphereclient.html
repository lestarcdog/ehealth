<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Canvas Test</title>
<script type="text/javascript"
	src="../../../main/webapp/js/framework/jquery-2.1.3.js"></script>
<script type="text/javascript"
	src="../../../main/webapp/js/framework/atmosphere.jquery.js"></script>
<script type="text/javascript"
	src="../../../main/webapp/js/framework/canvasjs.js"></script>
</head>
<body>
	<div id="content">valami</div>

	<div>
		<h3>Canvas</h3>
		<div id="chartContainer" style="height: 300px; width: 100%;"></div>
	</div>

	<script type="text/javascript">
		var dps = [];
		var chart = new CanvasJS.Chart("chartContainer", {
			title : {
				text : "Dummy - values"
			},
			axisX: {
		        title: "X Axis Title",
		        valueFormatString:"HH:mm:ss",
		      },		      
			data : [ {
				type : "line",
				dataPoints : dps
				//dataPoints : [ {x: 10 , y: 50, label: "valami"},{x: 20 , y: 70, label: "valami2"}]
			} ]
		});

		chart.render();
	</script>
	<script type="text/javascript">
		var content = $("#content");
		var socket = $.atmosphere;
		var request = {
			url : "http://127.0.0.1:9090/test",
			logLevel : 'debug',
			transport : 'websocket',
			fallbackTransport : 'long-polling'
		};

		request.onOpen = function(response) {
			content.html($('<p>', {
				text : 'Atmosphere connected using ' + response.transport
			}));
			var cmd1 = {
				command : "subscribe",
				value : "jozsi"
			};
			subSocket.push(JSON.stringify(cmd1));

		};

		request.onMessage = function(response) {
			var message = response.responseBody;
			console.log(message);
			try {
				var realData = JSON.parse(message);
				var date = new Date(realData.time);
				console.log(realData.id + ":" + date.toLocaleTimeString() + ":"
						+ realData.value);
				dps.push({
					x : date.getTime(),
					y : realData.value,
					//label : date.toLocaleTimeString()
				});
				chart.render();

			} catch (e) {
				console.log('This does not look like a valid JSON: ',
						message.data);
				return;
			}
		};

		request.onError = function(response) {
			console.log(response)
		};

		var subSocket = socket.subscribe(request);
	</script>


</body>
</html>